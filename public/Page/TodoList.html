<!DOCTYPE html>
<html lang="kr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="BasicStyle.css">
    <link rel="styleSheet" href="TodoList.css">
  </head>
  <body>
    <div class="content">
      <nav><p>—</p><p>☐</p><p>✕</p></nav>
      <hr style=" margin-top: 8px; margin-bottom: 16px;">
      <div id="listDiv">
        <ul id="list"></ul>
        
      </div>

      <div id="listInput">
        <input type="text">
        <button  id="submitBtn">등록하기</button>
      </div>
    </div>
    <script>
      $(document).ready(function(){
        
        var TodoList=JSON.parse(localStorage.getItem('TodoList'));
        if(!TodoList){
          TodoList =[];
        }
        console.log(TodoList);
        

        function findIndex(TodoList,no) {
          
          var idx = TodoList.findIndex(function(todo){
            return todo.no == no;
          });
          return idx;
        }

        $('#list').ready(function listreset(){
            console.log('준비됨');
            $('#list').html('');
            var cnt=0;
            TodoList.forEach(function(todo){
              $('#list').append(
                  `<li data-no="10${cnt++}">
                    <input type='checkbox' ${todo.doen ? 'checked':''}/>
                    <span>${todo.titel}</span>
                    <button>✕</button>
                  </li>`
                );
                
            });
          $('li button').click(function(e){
            let idx = findIndex(TodoList,$(e.target).data('no'));
            TodoList.splice(idx,1);
            $(e.target).parent().remove();
            localStorage.setItem('TodoList',JSON.stringify(TodoList));
          })
          $('span').dblclick(function(e){
            console.log($(e.target).find('span'));
            $(e.target).html(`<input/>`);
            $(e.target).find('input').focus();
            $('input').on('keyup');
            $('input').keyup(function(e){
              $(e.target).find('input').on('keyup');
              if(e.keyCode == 13){
                $(e.target).parent().text($(e.target).val());
                localStorage.setItem('TodoList',JSON.stringify(TodoList));
                $('input').off('keyup');
              }
              
            });
          });
          $('#list input').click(function(e){
            $(e.target).data('no',$(e.target).parent().data('no'));
            let idx = findIndex(TodoList,$(e.target).data('no'));
            TodoList[idx].doen = !TodoList[idx].doen;
            localStorage.setItem('TodoList',JSON.stringify(TodoList));
            if(TodoList[idx].doen){
              $(e.target).parent().css({
                backgroundColor: 'rgba(100, 100, 100, 0.5)',
                color:'rgba(100, 100, 100, 0.5)'
              }); 
            }else{
              $(e.target).parent().css({
                backgroundColor: '',
                color:''
              });
            };
          });
          $('#submitBtn').click(function(e){
              $(e.target).data('input',$(e.target).parent().find('input').val());
              $(e.target).parent().parent().find('#list').append(
                `<li data-no="${TodoList.length+100}">
                  <input type='checkbox'/>
                  <span>${$(e.target).data('input')}</span>
                  <button>✕</button>
                </li>`
              );
              TodoList.push({no:TodoList.length+100,titel:`${$(e.target).data('input')}`,doen:false});
              localStorage.setItem('TodoList',JSON.stringify(TodoList));
              $(e.target).parent().find('input').val('');
              $(e.target).parent().find('input').focus();
              $('#submitBtn').off();
              $('#listDiv').unbind('ready').bind('ready',listreset());
            });
        });
      })
    </script>
  </body>
</html>